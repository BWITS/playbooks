---
# --------------------------------------------
#   Common tasks for Helios master and agent
# --------------------------------------------
- debug: msg="ansible_hostname = '{{ ansible_hostname }}'"
- debug: msg="helios_master = '{{ helios_master }}'"
- debug: msg="helios_master_port = '{{ helios_master_port }}'"
- debug: msg="zookeeper_port = '{{ zookeeper_port }}'"
- debug: msg="etcd_port = '{{ etcd_port }}'"
- debug: msg="skydns_domain = '{{ skydns_domain }}'"

- include: "{{ common.utils.fake }}"
  vars:
    # We have Java 8 JRE installed already
    package: java7-runtime

- name: Calculating Helios version
  set_fact:
    helios_version:     "{{ helios.version     | calculate( helios.latest ) }}"
    helios_master_port: "{{ helios_master_port | default( helios.master.port ) }}"

- include: "{{ common.utils.download }}"
  vars:
    title:   Helios
    url:     "{{ helios.url     | tokens({ 'version': helios_version }) }}"
    archive: "{{ helios.archive | tokens({ 'version': helios_version }) }}"
    home:    "{{ helios.home }}"

- name: Installing Helios services
  apt:  deb="{{ helios.home }}/helios-services_{{ helios_version }}_all.deb"

- name: Installing Python pip
  apt:  name=python-pip state=latest force=yes

- name: Installing zk-shell
  pip:  name=zk-shell state=latest
