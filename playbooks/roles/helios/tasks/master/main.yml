---
- debug: var=helios_master_port
- debug: var=zookeeper_port
- debug: var=registrar_port
- debug: var=exhibitor_port
- debug: var=domain

- include: zookeeper.yml
- include: exhibitor.yml

- name: Copying Helios master config
  template:
    src:  master-config
    dest: "{{ helios.master.config }}"

- name: Installing Helios master
  apt:  deb="{{ helios.home }}/helios-master_{{ helios_version }}_all.deb"

- name: Restarting Helios master service
  service: name=helios-master state=restarted enabled=yes

- name: Verifying Helios master endpoint
  wait_for: port={{ helios_master_port }} timeout=10

- name: Verifying Helios master HTTP endpoint
  uri:  url=http://{{ common.net.localhost }}:{{ helios_master_port }} status_code=404

- include: "{{ playbook_dir }}/roles/skydns/register-host.yml"
  vars:
    etcd_host:   "{{ common.net.localhost }}"
    etcd_port:   "{{ registrar_port }}"
    skydns_host: "{{ common.net.localhost }}"
    fqdn:        "{{ ansible_fqdn }}"
    ip:          "{{ facter_ipaddress_eth1 }}"
