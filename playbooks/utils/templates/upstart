description "{{ service }}"

start on runlevel [2345]

# http://upstart.ubuntu.com/cookbook/#start-depends-on-another-service

{% if depends is defined %}
start on started {{ depends }}
{% endif %}
{% if dependent is defined %}
start on starting {{ dependent }}
{% endif %}

{% if (( depends is not defined ) and ( dependent is not defined )) %}
{% endif %}

stop  on runlevel [!2345]

respawn
respawn limit unlimited

script
    {% if env_file is defined %}
    [ -r '{{ env_file }}' ] && . '{{ env_file }}'
    {% endif %}
    exec {{ ubuntu.bash }} -c "{{ command }} >> '{{ ubuntu.log_dir }}/{{ service }}.log' 2>&1"
end script

# prevent respawning more than once every second
post-stop exec sleep 1
